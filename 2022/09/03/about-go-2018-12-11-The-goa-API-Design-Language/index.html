<!DOCTYPE html>
<html  lang="zh-CN" >
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>The goa API Design Language | 自留地</title>
    <meta name="description" content="GOA Design Language">
<meta property="og:type" content="article">
<meta property="og:title" content="The goa API Design Language">
<meta property="og:url" content="https://juzipeek.github.io/2022/09/03/about-go-2018-12-11-The-goa-API-Design-Language/index.html">
<meta property="og:site_name" content="自留地">
<meta property="og:description" content="GOA Design Language">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-09-03T14:47:35.232Z">
<meta property="article:modified_time" content="2022-09-03T14:54:58.881Z">
<meta property="article:author" content="zhou cheng jie">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">

    
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

    
<link rel="stylesheet" href="/css/common.min.css">



    
    
    
    
        <link href="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css" rel="stylesheet">
    
    
    
<link rel="stylesheet" href="/css/iconfont.min.css">

    
    <script>
        (function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)}
        ;a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s
        ;c.parentNode.insertBefore(a,c)
        })(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js");

        galite('create', 'G-HFGFGEWD53', 'auto');
        galite('send', 'pageview');
    </script>
    
<meta name="generator" content="Hexo 5.4.2"></head>

    <body>
        <header class="header header-fixture">
    <div class="profile-search-wrap flex sm:block">
        
        
        <div class="profile sm:text-center md:px-1 lg:px-3 sm:pb-4 sm:pt-6">
            <a id="avatar" role="link" href="https://github.com/juzipeek" class="inline-block lg:w-16 lg:h-16 w-8 h-8 m-2" target="_blank" rel="noopener" rel="noreferrer" >
                <img src="/images/yellow.jpg" class="rounded-full" alt="avatar">
            </a>
            <h2 id="name" class="hidden lg:block">zhou cheng jie</h2>
            <h3 id="title" class="hidden lg:block">coder</h3>
            
            <small id="location" class="hidden lg:block">
                <i class="iconfont icon-map-icon"></i>
                BeiJing, China
            </small>
            
        </div>
        
        
<div class="search flex-1 flex lg:inline-block sm:hidden lg:px-4 lg:mt-2 lg:mb-4 lg:w-full">
    <form id="search-form" class="my-auto flex-1 lg:border lg:border-solid lg:border-gray-200">
        <div class="input-group table bg-gray-100 lg:bg-white w-full">
            <input id="search-input" type="text" placeholder="搜索" class="inline-block w-full bg-gray-100 lg:bg-white p-1">
            <span class="table-cell">
                <button name="search tigger button" disabled>
                    <i class="iconfont icon-search m-2"></i>
                </button>
            </span>
        </div>
    </form>
        
<div id="content-json" data-placeholder="搜索" class="invisible hidden">/content.json</div>
<script id="search-teamplate" type="text/html" data-path="/content.json">
    <div>
        <div class="search-header bg-gray-400">
            <input id="actual-search-input" model="keyword" ref="input" class="inline-block w-full h-10 px-2 py-1" placeholder="搜索" type="text">
        </div>
        <div class="search-result bg-gray-200">
            {{#each searchPosts}}
            <a href="/{{ path }}" class="result-item block px-2 pb-3 mb-1 pt-1 hover:bg-indigo-100">
                <i class="iconfont icon-file"></i>
                <h1 class="result-title inline font-medium text-lg">{{ title }}</h1>
                <p class="result-content text-gray-600 text-sm">{{{ text }}}</p>
            </a>
            {{/each}}
        </div>
    </div>
</script>

</div>


        <button name="menu toogle button" id="menu-toggle-btn" class="block sm:hidden p-3" role="button" aria-expanded="false">
            <i class="iconfont icon-hamburger"></i>
        </button>
    </div>
    <nav id="menu-nav" class="hidden sm:flex flex-col">
        
        
            <div class="menu-item menu-home" role="menuitem">
                <a href="/.">
                    <i class="iconfont icon-home" aria-hidden="true"></i>
                    <span class="menu-title">首页</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-archives" role="menuitem">
                <a href="/archives">
                    <i class="iconfont icon-archive" aria-hidden="true"></i>
                    <span class="menu-title">归档</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-categories" role="menuitem">
                <a href="/categories">
                    <i class="iconfont icon-folder" aria-hidden="true"></i>
                    <span class="menu-title">分类</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-tags" role="menuitem">
                <a href="/tags">
                    <i class="iconfont icon-tag" aria-hidden="true"></i>
                    <span class="menu-title">标签</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-about" role="menuitem">
                <a href="/about">
                    <i class="iconfont icon-cup" aria-hidden="true"></i>
                    <span class="menu-title">关于</span>
                </a>
            </div>
        
        
<div class="social-links flex sm:flex-col lg:hidden mt-5">
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://github.com/juzipeek">
                <i class="iconfont social-icon icon-github"></i>
                <span class="menu-title hidden lg:inline">menu.github</span>
            </a>
        </span>
    
</div>


    </nav>
</header>

        <section class="main-section">
            
    <main class="flex-1 px-4 py-14 md:px-5 lg:px-8 lg:py-4 relative min-h-screen">
    

    <article class="content article article-archives article-type-list" itemscope="">
        <header class="article-header">
            
    
        <h1 class="article-title text-lg" itemprop="name">
            The goa API Design Language
        </h1>
    



            <p class="article-meta mb-3 text-xs">
                <span class="article-date">
    <i class="iconfont icon-calendar-check"></i>
	<a href="/2022/09/03/about-go-2018-12-11-The-goa-API-Design-Language/" class="article-date">
	  <time datetime="2022-09-03T14:47:35.232Z" itemprop="datePublished">9月 3</time>
	</a>
</span>

                
    <span class="article-category">
    <i class="iconfont icon-folder"></i>
    <a class="article-category-link" href="/categories/Go/">Go</a>
  </span>


                
    <span class="article-tags">
    <i class="iconfont icon-tag"></i>
    <a class="article-tag-none-link" href="/tags/Go/" rel="tag">Go</a>
  </span>


                <span class="_partial/post-comment"><i class="icon icon-comment"></i>
                    <a href="/2022/09/03/about-go-2018-12-11-The-goa-API-Design-Language/#comments" class="article-comment-link">
                        评论
                    </a>
                </span>
                
    
        <span class="post-wordcount" itemprop="wordCount">字数统计: 4.2k(字)</span>
    
    
        <span class="post-readcount" itemprop="timeRequired">阅读时长: 18(分)</span>
    


            </p>
        </header>
        <div class="marked-body article-body">
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>goa API 设计语言是 Go 中实现的 DSL，可以描述任意微服务API。虽然主要关注的是基于 REST 的 HTTP API，但该语言足够灵活，可以描述遵循其他方法的 API。使用插件可以扩展核心 DSL 以允许描述微服务的其他方面，例如数据库模型，服务发现集成，故障处理程序等。</p>
<h2 id="设计定义"><a href="#设计定义" class="headerlink" title="设计定义"></a>设计定义</h2><p>设计语言的核心是由链接在一起描述定义的函数组成。goa 设计语言根定义是 API 定义，定义它的 DSL 如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    . <span class="string">&quot;github.com/goadesign/goa/design&quot;</span></span><br><span class="line">    . <span class="string">&quot;github.com/goadesign/goa/design/apidsl&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ = API(<span class="string">&quot;My API&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;        <span class="comment">// &quot;My API&quot; is the name of the API used in docs</span></span><br><span class="line">    Title(<span class="string">&quot;Documentation title&quot;</span>)      <span class="comment">// Documentation title</span></span><br><span class="line">    Description(<span class="string">&quot;The next big thing&quot;</span>) <span class="comment">// Longer documentation description</span></span><br><span class="line">    Host(<span class="string">&quot;goa.design&quot;</span>)                <span class="comment">// Host used by Swagger and clients</span></span><br><span class="line">    Scheme(<span class="string">&quot;https&quot;</span>)                   <span class="comment">// HTTP scheme used by Swagger and clients</span></span><br><span class="line">    BasePath(<span class="string">&quot;/api&quot;</span>)                  <span class="comment">// Base path to all API endpoints</span></span><br><span class="line">    Consumes(<span class="string">&quot;application/json&quot;</span>)      <span class="comment">// Media types supported by the API</span></span><br><span class="line">    Produces(<span class="string">&quot;application/json&quot;</span>)      <span class="comment">// Media types generated by the API</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关于“点导入”的旁注通常会出现这个问题：goa API 设计语言是在 Go 中实现的 DSL，而不是 Go（“点导入”的含义就是这个包导入之后在调用这个包的函数时，可以省略前缀的包名）。生成的代码或 goa 中的任何实际 Go 代码都不使用“点导入”。将此技术用于 DSL 可以获得更清晰的代码。它还允许透明地混合来自插件的 DSL，等待。</p>
<p>DSL 大量使用匿名函数来递归地描述各种定义。在上面的示例中，API 函数接受 API 的名称作为第一个参数，并接受匿名函数作为第二个参数。此匿名函数在本文档中也称为DSL，它定义了 API 的其他属性。许多其他 DSL 函数同样使用此模式（名称 + DSL）。</p>
<p>API 函数定义 API 的一般属性：文档中使用的 <code>Title</code> 和 <code>Description</code>，服务条款（上面的示例中未显示）文档和客户端中使用的默认主机和协议方案以及所有 API 端点的基本路径（可选地还通过基本路径中定义的通配符捕获相应的基本参数）。</p>
<p>该函数还定义了 API 支持的媒体类型。<code>Consumes</code> 和 <code>Produces</code> 函数可以为请求（Consumes）和响应（Produces）定义支持媒体类型，也可以指定生成的代码用于解码请求包体和编码响应包体的编码包。</p>
<p>API 函数中还可以定义许多其他属性，从附加元数据（联系信息）到安全定义，CORS 策略和响应模板。有关完整列表，请参阅参考资料。</p>
<h2 id="API-端点"><a href="#API-端点" class="headerlink" title="API 端点"></a>API 端点</h2><p>除了根 API 定义之外，goa API 设计语言还可以描述实现端点以及请求和响应的详细信息。Resource 函数定义了一组相关的 API 端点 - 如果 API 是 RESTful，则为资源。使用 Action 函数描述每个实际端点。以下是一个简单的 <code>Operands</code> 资源示例，公开了一个添加操作（API 端点）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = Resource(<span class="string">&quot;Operands&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;        <span class="comment">// Defines the Operands resource</span></span><br><span class="line">    Action(<span class="string">&quot;add&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;                   <span class="comment">// Defines the add action</span></span><br><span class="line">        Routing(GET(<span class="string">&quot;/add/:left/:right&quot;</span>))    <span class="comment">// The relative path to the add endpoint</span></span><br><span class="line">        Description(<span class="string">&quot;add returns the sum of :left and :right in the response body&quot;</span>)</span><br><span class="line">        Params(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;                      <span class="comment">// Defines the request parameters</span></span><br><span class="line">                                             <span class="comment">// found in the URI (wildcards) and querystring</span></span><br><span class="line">            Param(<span class="string">&quot;left&quot;</span>, Integer, <span class="string">&quot;Left operand&quot;</span>)   <span class="comment">// Defines left parameter as path segment</span></span><br><span class="line">                                                     <span class="comment">// captured by :left</span></span><br><span class="line">            Param(<span class="string">&quot;right&quot;</span>, Integer, <span class="string">&quot;Right operand&quot;</span>) <span class="comment">// Define right parameter as path segment</span></span><br><span class="line">                                                     <span class="comment">// captured by :right</span></span><br><span class="line">        &#125;)</span><br><span class="line">        Response(OK, <span class="string">&quot;plain/text&quot;</span>)           <span class="comment">// Defines response</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一个 <code>Resource</code> 函数可以定义任意数量的 <code>Action</code>。<code>Resource</code> 可定义公共基本路径，公共路径参数和其他的属性可以被 <code>Resource</code> 的参数共享。一个 <code>Action</code> 可以定义多个路由（<code>Routing</code> 函数的参数是可变参数），同一个 API 端点可以通过不同的路由或使用不同的 HTTP 方法访问。</p>
<p>在 DSL 中用于定义 <code>Action</code> 的参数可以指定参数的验证规则，范围从整数和数字的最小值和最大值到通过字符串参数的正则表达式定义的模式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Param(<span class="string">&quot;left&quot;</span>, Integer, <span class="string">&quot;Left operand&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Minimum(<span class="number">0</span>) <span class="comment">// Do not allow for negative values.</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文件服务器"><a href="#文件服务器" class="headerlink" title="文件服务器"></a>文件服务器</h2><p><code>Files</code> 函数可以在资源上定义文件服务器。文件服务器可以提供对单个静态文件或如果路由以以 <code>*</code> 开头的通配符结束，则在给定文件路径下的所有文件。<code>Files</code> 函数可选择接受子 DSL（匿名函数作为最后一个参数）来定义安全方案。语法与用于定义操作的安全方案的语法相同。</p>
<p>以下演示了一个名叫 <code>public</code> 的资源，里面有两个文件服务器，一个为发送到 <code>/swagger.json</code> 的请求提供文件 <code>public/swagger/swagger.json</code>，另一个是发送到 <code>/js/*filepath的public/js/</code> 下的所有其他文件，其中 <code>*filepath</code> 的值对应于相对于 /public/js 的文件路径。swagger 端点还定义了一个安全方案，要求客户端在能够检索 swagger 规范之前进行身份验证。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = Resource(<span class="string">&quot;public&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    Origin(<span class="string">&quot;*&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;        <span class="comment">// CORS policy that applies to all actions and file servers</span></span><br><span class="line">        Methods(<span class="string">&quot;GET&quot;</span>)          <span class="comment">// of &quot;public&quot; resource</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Files(<span class="string">&quot;/swagger.json&quot;</span>, <span class="string">&quot;public/swagger/swagger.json&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Security(<span class="string">&quot;basic_auth&quot;</span>)  <span class="comment">// Security scheme implemented by /swagger.json endpoint</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Files(<span class="string">&quot;/js/*filepath&quot;</span>, <span class="string">&quot;public/js/&quot;</span>) <span class="comment">// Serve all files under the public/js directory</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>goa API 设计语言可以描述任意的数据类型，API 可用于定义请求包体和响应媒体类型。<code>Type</code> 函数通过使用 <code>Attribute</code> 函数列出每个字段来描述数据结构，它还可以使用<code>ArrayOf</code> 函数来定义数组或数组。以下为示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Operand describes a single operand with a name and an integer value.</span></span><br><span class="line"><span class="keyword">var</span> Operand = Type(<span class="string">&quot;Operand&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Attribute(<span class="string">&quot;name&quot;</span>, String, <span class="string">&quot;Operand name&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// Attribute name of type string</span></span><br><span class="line">        Pattern(<span class="string">&quot;^x&quot;</span>)                                  <span class="comment">// with regex validation</span></span><br><span class="line">    &#125;)</span><br><span class="line">    Attribute(<span class="string">&quot;value&quot;</span>, Integer, <span class="string">&quot;Operand value&quot;</span>)  <span class="comment">// Attribute value of type integer</span></span><br><span class="line">    Required(<span class="string">&quot;value&quot;</span>)                             <span class="comment">// only value is required</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Series represents an array of operands.</span></span><br><span class="line"><span class="keyword">var</span> Series = ArrayOf(Operand)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>请注意，与 API 函数一样，Type 函数接受两个参数：名称和描述类型属性的 DSL。<code>Type</code> DSL类型包含三个功能：</p>
<ul>
<li>Description：设置类型描述</li>
<li>Attribute：定义单个类型字段</li>
<li>Required：列出必填字段：必须始终存在于该类型实例中的字段</li>
</ul>
<p><code>Type</code> 函数可用于定义 <code>Action</code> 有效负载（以及其他内容）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Action(<span class="string">&quot;sum&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;          <span class="comment">// Defines the sum action</span></span><br><span class="line">    Routing(POST(<span class="string">&quot;/sum&quot;</span>))       <span class="comment">// The relative path to the add endpoint</span></span><br><span class="line">    Description(<span class="string">&quot;sum returns the sum of all the operands in the response body&quot;</span>)</span><br><span class="line">    Payload(Series)             <span class="comment">// Defines the action request body shape using the Series</span></span><br><span class="line">                                <span class="comment">// type defined above.</span></span><br><span class="line">    Response(OK, <span class="string">&quot;plain/text&quot;</span>)  <span class="comment">// Defines a response</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h2><p><code>Attribute</code> 在 goa DSL 中扮演着特殊的角色，它们是用于定义数据结构的基础。<code>Attribute</code> DSL 用于描述类型字段，请求参数，请求有效负载，响应头，响应主体等基本上任何需要定义数据结构的地方。定义属性的语法非常灵活，允许根据需要指定尽可能少的或完整的定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Attribute(&lt;name&gt;, &lt;<span class="keyword">type</span>&gt;, &lt;description&gt;, &lt;dsl&gt;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只需要第一个参数，所有其他参数都是可选的。默认属性类型是 String。属性的可能类型是：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Go equivalent</th>
<th>JSON equivalent</th>
</tr>
</thead>
<tbody><tr>
<td>Boolean</td>
<td>bool</td>
<td>“true” or “false”</td>
</tr>
<tr>
<td>Integer</td>
<td>int</td>
<td>number</td>
</tr>
<tr>
<td>Number</td>
<td>float</td>
<td>number</td>
</tr>
<tr>
<td>String</td>
<td>string</td>
<td>string</td>
</tr>
<tr>
<td>DateTime</td>
<td>time.Time</td>
<td>RFC3339 string</td>
</tr>
<tr>
<td>UUID</td>
<td>uuid.UUID</td>
<td>RFC4122 string</td>
</tr>
<tr>
<td>Any</td>
<td>interface{}</td>
<td>?</td>
</tr>
</tbody></table>
<p>另外，可以使用 <code>ArrayOf</code> 或 <code>HashOf</code> 或使用递归 DSL 定义类型字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = Type(<span class="string">&quot;user&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;A user of the API&quot;</span>)</span><br><span class="line">    Attribute(<span class="string">&quot;name&quot;</span>)                 <span class="comment">// Simple string attribute</span></span><br><span class="line">    Attribute(<span class="string">&quot;address&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;     <span class="comment">// Nested definition, defines a struct in Go</span></span><br><span class="line">        Attribute(<span class="string">&quot;number&quot;</span>, Integer, <span class="string">&quot;Street number&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;street&quot;</span>, String, <span class="string">&quot;Street name&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;city&quot;</span>, String, <span class="string">&quot;City&quot;</span>)</span><br><span class="line">        Required(<span class="string">&quot;city&quot;</span>)              <span class="comment">// The address must contain at least a city</span></span><br><span class="line">    &#125;)</span><br><span class="line">    Attribute(<span class="string">&quot;friends&quot;</span>, ArrayOf(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">    Attribute(<span class="string">&quot;data&quot;</span>, HashOf(String, String))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>请注意使用 “user” 类型名称来定义 <code>friends</code> 字段，而不是引用 <code>User</code> 类型变量。其实两种语法（使用“user”类型或“User”变量定义数组）都被接受。使用名称而不是变量引用允许构建递归定义。</p>
<p>示例 <a target="_blank" rel="noopener" href="https://github.com/goadesign/examples">Github</a> 存储库包含一个类型目录，其中包含许多示例，用于演示设计类型和生成的代码之间的映射。</p>
<h2 id="Responses"><a href="#Responses" class="headerlink" title="Responses"></a>Responses</h2><h3 id="Response-Media-Types"><a href="#Response-Media-Types" class="headerlink" title="Response Media Types"></a>Response Media Types</h3><p>接下来查看响应，goa 设计语言 <code>MediaType</code> 函数描述了表示响应主体的媒体类型。<code>MediaType</code> 的定义类似于 <code>Type</code> 的定义（媒体类型是一种特殊类型）但 <code>MediaType</code> 有两个独特的属性：</p>
<ul>
<li><strong>Views</strong>：可以描述相同 <code>MediaType</code> 的不同渲染。通常，API 在列出请求时使用资源的“短”表示，并在返回单个资源的请求中使用更详细的表示。视图通过提供定义这些不同表示的方式来涵盖该用例。<code>MediaType</code> 定义必须定义用于呈现资源的默认视图（恰当地命名为 <code>default</code>）。</li>
<li><strong>Links</strong>：表示应该嵌入在响应中的相关 <code>MediaType</code>。用于呈现链接的视图是链接，这意味着链接到的媒体类型必须定义链接视图。链接在媒体类型定义中的 <code>Links</code> 函数下列出。然后，视图可以使用指定 <code>links</code> 属性来呈现所有链接。</li>
</ul>
<p>以下是 <code>MediaType</code> 定义的示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Results is the media type that defines the shape of the &quot;add&quot; action response.</span></span><br><span class="line"><span class="keyword">var</span> Results = MediaType(<span class="string">&quot;vnd.application/goa.results&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;The results of an operation&quot;</span>)</span><br><span class="line">    Attributes(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;                              <span class="comment">// Defines the media type attributes</span></span><br><span class="line">        Attribute(<span class="string">&quot;value&quot;</span>, Integer, <span class="string">&quot;Results value&quot;</span>) <span class="comment">// Operation results attribute</span></span><br><span class="line">        Attribute(<span class="string">&quot;requester&quot;</span>, User)                 <span class="comment">// Requester attribute</span></span><br><span class="line">    &#125;)</span><br><span class="line">    Links(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;             <span class="comment">// Defines the links embedded in the media type</span></span><br><span class="line">        Link(<span class="string">&quot;requester&quot;</span>)      <span class="comment">// One link to the requester, will be rendered</span></span><br><span class="line">                               <span class="comment">// using the &quot;link&quot; view of User media type.</span></span><br><span class="line">    &#125;)</span><br><span class="line">    View(<span class="string">&quot;default&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;   <span class="comment">// Defines the default view</span></span><br><span class="line">        Attribute(<span class="string">&quot;value&quot;</span>)     <span class="comment">// Includes the &quot;value&quot; field in the default view</span></span><br><span class="line">        Attribute(<span class="string">&quot;links&quot;</span>)     <span class="comment">// And render links</span></span><br><span class="line">    &#125;)</span><br><span class="line">    View(<span class="string">&quot;extended&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;  <span class="comment">// Defines the extended view</span></span><br><span class="line">        Attribute(<span class="string">&quot;value&quot;</span>)     <span class="comment">// Includes the value field</span></span><br><span class="line">        Attribute(<span class="string">&quot;requester&quot;</span>) <span class="comment">// and the requester field</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User is the media type used to render user resources.</span></span><br><span class="line"><span class="keyword">var</span> User = MediaType(<span class="string">&quot;vnd.application/goa.users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;A user of the API&quot;</span>)</span><br><span class="line">    Attributes(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Attribute(<span class="string">&quot;id&quot;</span>, UUID, <span class="string">&quot;Unique identifier&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;href&quot;</span>, String, <span class="string">&quot;User API href&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;email&quot;</span>, String, <span class="string">&quot;User email&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Format(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    View(<span class="string">&quot;default&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Attribute(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;href&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    View(<span class="string">&quot;link&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// The view used to render links to User media types.</span></span><br><span class="line">        Attribute(<span class="string">&quot;href&quot;</span>) <span class="comment">// Here only the href attribute is rendered in links.</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Defining-Responses"><a href="#Defining-Responses" class="headerlink" title="Defining Responses"></a>Defining Responses</h3><p><code>Response</code> 函数用于 <code>Action</code> 声明以定义特定的潜在响应，它描述了响应状态代码，如果响应包含正文和标题，则为媒体类型。每个 <code>Response</code> 必须在 <code>Action</code> 范围内具有唯一名称，与大多数其他 DSL 功能一样，名称是第一个参数。以下 DSL 定义了一个名为“NoContent”的响应，该响应使用 HTTP 状态代码 204：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;NoContent&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;This is the response returned in case of success&quot;</span>)</span><br><span class="line">    Status(<span class="number">204</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>请注意，此示例以及本节中的所有其他示例不使用响应模板，因此定义响应的所有属性，包括其名称。实际上，在大多数情况下，使用其中一个内置模板定义响应实现上面的响应（不添加描述）可以省略到：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response(NoContent)</span><br></pre></td></tr></table></figure>

<p>响应模板将在下面的部分中详细介绍，但在我们讲解它们之前，我们必须首先了解 <code>Response</code> 的工作原理。</p>
<p>如果 <code>Response</code> 包含正文，则使用 <code>Media</code> 函数指定相应的媒体类型。此函数接受媒体类型标识符或实际媒体类型值作为第一个参数，并可选择接受用于呈现响应正文的媒体类型视图的名称。该视图是可选的，因为相同的 <code>Action</code> 可以根据请求状态返回不同的视图。以下是使用状态代码 200 和结果媒体类型的“OK”响应的 <code>Results</code> 定义示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;OK&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;This is the success response&quot;</span>)</span><br><span class="line">    Status(<span class="number">200</span>)</span><br><span class="line">    Media(Results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>为方便起见，响应的媒体类型可以作为 <code>Response</code> 函数的第二个参数提供（这在使用响应模板时特别有用，如下面相应部分所述）。因此上面的代码等同于如下代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;OK&quot;</span>, Results, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;This is the success response&quot;</span>)</span><br><span class="line">    Status(<span class="number">200</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>假设 <code>Results</code> 的标识符是 <code>application/vnd.example.results</code>，则上述内容相当于：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;OK&quot;</span>, <span class="string">&quot;application/vnd.example.results&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;This is the success response&quot;</span>)</span><br><span class="line">    Status(<span class="number">200</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>请注意，媒体类型标识符（上例中的 <code>application/vnd.example.results</code>）可能对应于通过 <code>MediaType</code> 函数定义的媒体类型的标识符。当媒体类型标识符与设计中定义的媒体类型不匹配时，生成的代码使用 Go 语言中 <code>[]byte</code> 来定义响应主体的类型。</p>
<p>如果父操作始终返回默认视图，则响应可以定义为：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;OK&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;This is the success response&quot;</span>)</span><br><span class="line">    Status(<span class="number">200</span>)</span><br><span class="line">    Media(Results, <span class="string">&quot;default&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>响应包头是使用 <code>Headers</code> 函数定义的，定义每个包头的语法与用于定义属性的语法相同：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Response(<span class="string">&quot;OK&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Status(<span class="number">200</span>)</span><br><span class="line">    Media(Results, <span class="string">&quot;default&quot;</span>)</span><br><span class="line">    Headers(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Header(<span class="string">&quot;Location&quot;</span>, String, <span class="string">&quot;Resource location&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Pattern(<span class="string">&quot;/results/[0-9]+&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        Header(<span class="string">&quot;ETag&quot;</span>) <span class="comment">// assumes String type as with Attribute</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="使用默认-MediaType"><a href="#使用默认-MediaType" class="headerlink" title="使用默认 MediaType"></a>使用默认 <code>MediaType</code></h3><p><code>Resource</code> 可以为所有操作定义默认媒体类型。定义默认媒体类型有两个效果：</p>
<ul>
<li>  默认媒体类型用于返回状态代码 200 且未定义媒体类型的所有响应。</li>
<li>  在响应包体、操作参数和响应媒体类型上定义的属性与默认媒体类型上定义的属性名称匹配，自动从其继承所有属性（描述，类型，验证等）</li>
</ul>
<p>请考虑以下资源定义，该定义使用上面定义的 <code>Results</code> 媒体类型作为默认媒体类型，并利用它定义 <code>add</code> 动作的 <code>OK</code> 响应：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = Resource(<span class="string">&quot;Operands&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    DefaultMedia(Results)</span><br><span class="line">    Action(<span class="string">&quot;add&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Routing(GET(<span class="string">&quot;/add/:left/:right&quot;</span>))</span><br><span class="line">        Params(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Param(<span class="string">&quot;left&quot;</span>, Integer, <span class="string">&quot;Left operand&quot;</span>)</span><br><span class="line">            Param(<span class="string">&quot;right&quot;</span>, Integer, <span class="string">&quot;Right operand&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        Response(OK)         <span class="comment">// Uses the resource default media type</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在假设 <code>Results</code> 媒体类型还返回用于计算总和的初始操作数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Results = MediaType(<span class="string">&quot;vnd.application/goa.results&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Description(<span class="string">&quot;The results of an operation&quot;</span>)</span><br><span class="line">    Attributes(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Attribute(<span class="string">&quot;left&quot;</span>, Integer, <span class="string">&quot;Left operand&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;right&quot;</span>, Integer, <span class="string">&quot;Right operand&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;value&quot;</span>, Integer, <span class="string">&quot;Results value&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;requester&quot;</span>, User)</span><br><span class="line">    &#125;)</span><br><span class="line">    View(<span class="string">&quot;default&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Attribute(<span class="string">&quot;left&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;right&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;value&quot;</span>)</span><br><span class="line">        Attribute(<span class="string">&quot;requester&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>add</code> 操作定义可以利用这一点来避免必须重复 <code>left</code>、<code>right</code> 参数的类型和注释：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = Resource(<span class="string">&quot;Operands&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    DefaultMedia(Results)</span><br><span class="line">    Action(<span class="string">&quot;add&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Routing(GET(<span class="string">&quot;/add/:left/:right&quot;</span>))</span><br><span class="line">        Params(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Param(<span class="string">&quot;left&quot;</span>)    <span class="comment">// Inherits type and description from default media type</span></span><br><span class="line">            Param(<span class="string">&quot;right&quot;</span>)   <span class="comment">// Inherits type and description from default media type</span></span><br><span class="line">        &#125;)</span><br><span class="line">        Response(OK)         <span class="comment">// Uses the resource default media type</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="响应模版"><a href="#响应模版" class="headerlink" title="响应模版"></a>响应模版</h3><p>goa API 设计语言允许在 API 级别定义响应模板，任何操作都可以利用它来定义响应。此类模板可以接受任意数量的字符串参数来定义任何响应属性。使用以下语法定义模板：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = API(<span class="string">&quot;My API&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ResponseTemplate(<span class="string">&quot;created&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(hrefPattern <span class="type">string</span>)</span></span> &#123; <span class="comment">// Defines the &quot;created&quot; template</span></span><br><span class="line">        Description(<span class="string">&quot;Resource created&quot;</span>)                    <span class="comment">// that takes one argument &quot;hrefPattern&quot;</span></span><br><span class="line">        Status(<span class="number">201</span>)                     <span class="comment">// using status code 201</span></span><br><span class="line">        Headers(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Header(<span class="string">&quot;Location&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;     <span class="comment">// and contains the &quot;Location&quot; header</span></span><br><span class="line">                Pattern(hrefPattern)        <span class="comment">// with a regex validation defined by the</span></span><br><span class="line">                                            <span class="comment">// value of the &quot;hrefPattern&quot; argument.</span></span><br><span class="line">		    &#125;)                                           </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后在定义响应时通过名称简单地引用模板来使用模板：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Action(<span class="string">&quot;sum&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Routing(POST(<span class="string">&quot;/accounts&quot;</span>))</span><br><span class="line">    Payload(AccountPayload)</span><br><span class="line">    Response(<span class="string">&quot;created&quot;</span>, <span class="string">&quot;^/results/[0-9]+&quot;</span>) <span class="comment">// Response uses the &quot;created&quot; response template.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>goa 框架所有标准 HTTP 状态码提供响应模板，因此不需要为简单情况定义模板。内置模板的名称与相应 HTTP 状态代码的名称匹配。例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Action(<span class="string">&quot;show&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Routing(GET(<span class="string">&quot;/:id&quot;</span>))</span><br><span class="line">    Response(<span class="string">&quot;ok&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Status(<span class="number">200</span>)</span><br><span class="line">        Media(AccountMedia)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Action(<span class="string">&quot;show&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Routing(GET(<span class="string">&quot;/:id&quot;</span>))</span><br><span class="line">    Response(OK, AccountMedia) <span class="comment">// Uses the built-in &quot;OK&quot; response template that defines status 200</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>goa 设计语言还包含很多内容，但是这个概述应该让你了解它的工作原理。goa 设计语言不需要很长时间就能运用自如，从而可以快速迭代和完善设计。可以与其他开发者共享 Swagger 定义以收集反馈进行迭代。一旦完成，<code>goagen</code> 将生成 <code>API</code> 脚手架，从设计中请求上下文和验证代码，从而将其实现。该设计成为一个始终与实施最新的生动文档。</p>

        </div>
        

    </article>
    
    <section id="comments">
        
    </section>


    

</main>


<aside style="" id="sidebar" class="aside aside-fixture">
    <div class="toc-sidebar">
        <nav id="toc" class="article-toc">
            <h3 class="toc-title">文章目录</h3>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">设计定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-%E7%AB%AF%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">API 端点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">文件服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attributes"><span class="toc-number">6.</span> <span class="toc-text">Attributes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Responses"><span class="toc-number">7.</span> <span class="toc-text">Responses</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Response-Media-Types"><span class="toc-number">7.1.</span> <span class="toc-text">Response Media Types</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Defining-Responses"><span class="toc-number">7.2.</span> <span class="toc-text">Defining Responses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4-MediaType"><span class="toc-number">7.3.</span> <span class="toc-text">使用默认 MediaType</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%A8%A1%E7%89%88"><span class="toc-number">7.4.</span> <span class="toc-text">响应模版</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol>
        </nav>
    </div>
</aside>





        </section>
        <footer class="hidden lg:block fixed bottom-0 left-0 sm:w-1/12 lg:w-1/6 bg-gray-100 z-40">
    
    <div class="footer-social-links">
        
            <a target="_blank" rel="noopener" href="https://github.com/juzipeek">
                <i class="iconfont icon-github"></i>
            </a>
        
    </div>
    
    
</footer>

        <div id="mask" class="hidden mask fixed inset-0 bg-gray-900 opacity-75 z-40"></div>
        <div id="search-view-container" class="hidden shadow-xl"></div>
        
<script src="/js/dom-event.min.js"></script>



<script src="/js/local-search.min.js"></script>



    <script src="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
<script src="/js/light-gallery.min.js"></script>






    </body>
</html>
